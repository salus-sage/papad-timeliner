const createReactAppPreset = require('babel-preset-react-app');

module.exports = function(api, opts = {}) {
  const config = Object.assign(
    {
      typescript: false,
      flow: true,
      absoluteRuntime: true,
    },
    opts
  );
  const env = process.env.BABEL_ENV || process.env.NODE_ENV;
  if (!env) {
    process.env.NODE_ENV = 'development';
  }
  const isEnvDevelopment = env === 'development';
  const useFlow = config.flow === false ? false : config.typescript === false;

  return {
    presets: [
      [
        createReactAppPreset,
        {
          flow: useFlow,
          typescript: config.typescript,
          absoluteRuntime: config.absoluteRuntime,
        },
      ],
    ].filter(Boolean),
    plugins: [
      require('@babel/plugin-transform-react-constant-elements').default,
      isEnvDevelopment &&
        require('@babel/plugin-transform-react-jsx-source').default,
    ].filter(Boolean),
  };
};
