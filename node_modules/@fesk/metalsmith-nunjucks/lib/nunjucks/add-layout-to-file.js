const ignoreFrontMatter = require('../utils/ignore-front-matter');
const templateContainsBlock = require('./template-contains-block');
const templateContainsRenderable = require('./template-contains-renderable');

function addLayoutToFile(file, layouts, defaultLayout) {
  if (
    file.layout === 'none' ||
    file.macro ||
    !templateContainsRenderable(file.contents.toString())
  ) {
    return ignoreFrontMatter(file.contents.toString());
  }
  if (file.layout && layouts[file.layout]) {
    const layout = layouts[file.layout];

    return `{% extends '${layout.fileName}' %} \n ${ignoreFrontMatter(
      file.contents.toString()
    )}`;
  }

  if (defaultLayout === 'none') {
    return ignoreFrontMatter(file.contents.toString());
  }

  if (templateContainsBlock(file.contents.toString(), 'body')) {
    return `{% extends '${
      layouts[defaultLayout].fileName
    }' %} \n ${ignoreFrontMatter(file.contents.toString())}`;
  }

  return `{% extends '${layouts[defaultLayout].fileName}' %}
{% block body %}   
   ${ignoreFrontMatter(file.contents.toString())}
{% endblock %}
`;
}

module.exports = addLayoutToFile;
