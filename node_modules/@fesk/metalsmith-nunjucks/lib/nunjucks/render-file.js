const path = require('path');
const renderError = require('../utils/render-error');

function renderFile({ engine, fileName, fileString, context }) {
  try {
    const renderedFile = engine.renderString(fileString, context, {
      path: path.dirname(fileName),
    });

    if (renderedFile === null) {
      if (engine.loaders[0] && engine.loaders[0].lastError) {
        throw engine.loaders[0].lastError;
      }
      throw new Error('Unknown error - check your imports');
    }

    return renderedFile;
  } catch (e) {
    return renderError(e, fileName, [{ name: fileName, contents: fileString }]);
  }
}

module.exports = renderFile;
