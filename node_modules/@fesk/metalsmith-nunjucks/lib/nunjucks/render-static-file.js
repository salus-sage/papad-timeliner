const path = require('path');
const renderError = require('../utils/render-error');

function renderStaticFile({
  engine,
  staticFileName,
  staticFileString,
  fileName,
  fileString,
  context,
}) {
  const njkFile = engine.getTemplate(fileName);
  const njkStaticFile = engine.getTemplate(staticFileName);

  try {
    return engine.renderString(
      njkStaticFile.tmplStr,
      {
        context,
        contents: engine.renderString(njkFile.tmplStr, context, {
          path: path.dirname(njkFile.path),
        }),
      },
      { path: path.dirname(njkStaticFile.path) }
    );
  } catch (err) {
    return renderError(err, fileName, [
      { name: njkFile.path, contents: njkFile.tmplStr },
      { name: njkStaticFile.path, contents: njkStaticFile.tmplStr },
    ]);
  }
}

module.exports = renderStaticFile;
