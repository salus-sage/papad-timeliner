const lexer = require('nunjucks/src/lexer');

function templateContainsBlock(str, blockName, options = {}) {
  const tokens = lexer.lex(str, { trimBlocks: true, ...options });

  // Finds {% block `blockName` %}
  while (!tokens.isFinished()) {
    let next = tokens.nextToken();
    if (next.type === 'block-start') {
      next = tokens.nextToken();
      if (next.type === 'whitespace') {
        next = tokens.nextToken();
      }
      if (next.type === 'symbol' && next.value === 'block') {
        next = tokens.nextToken();
        if (next.type === 'whitespace') {
          next = tokens.nextToken();
        }
        if (next.type === 'symbol' && next.value === blockName) {
          return true;
        }
      }
    }
  }
  return false;
}

module.exports = templateContainsBlock;
