const fs = require('fs');
const path = require('path');
const isLernaPackage = require('./is-lerna-package');
const isLernaRoot = require('./is-lerna-root');

function getLernaJson(packagePath) {
  const cwd = packagePath || process.cwd();

  if (isLernaPackage(cwd)) {
    return JSON.parse(
      fs.readFileSync(
        path.join(process.cwd(), '..', '..', 'lerna.json'),
        'utf-8'
      )
    );
  }

  if (isLernaRoot(cwd)) {
    return JSON.parse(
      fs.readFileSync(path.join(process.cwd(), 'lerna.json'), 'utf-8')
    );
  }

  throw new Error(
    'This must be run in the Lerna root, or in a Lerna package root.'
  );
}

module.exports = getLernaJson;
