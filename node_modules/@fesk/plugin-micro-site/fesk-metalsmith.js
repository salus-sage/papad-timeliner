const path = require('path');
const markdownPlugin = require('@fesk/plugin-markdown');
const fs = require('fs');

module.exports = function(metalsmith, configuration) {
  const config = configuration || {};

  return markdownPlugin(
    metalsmith.use(files => {
      if (!files['layouts/default.twig']) {
        files['layouts/default.twig'] = {
          mode: '0644',
          contents: fs.readFileSync(
            path.resolve(__dirname, 'lib', 'layouts', 'micrositeLayout.twig')
          ),
        };
      }
    }),
    config
  );
};
