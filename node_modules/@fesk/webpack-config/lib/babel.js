const path = require('path');
const fs = require('fs');
const webpack = require('webpack');
const Config = require('webpack-config').default;

const indexTs = fs.existsSync(path.join(process.cwd(), 'src', 'index.ts'));
const indexTsx = fs.existsSync(path.join(process.cwd(), 'src', 'index.tsx'));

const babelLoader = (indexTs || indexTsx)
  ? require('./loaders/babel-ts')
  : require('./loaders/babel');

module.exports = new Config().merge({
  module: {
    rules: [babelLoader],
  },
  plugins: [
    new webpack.DefinePlugin({
      'process.env.NODE_ENV': JSON.stringify(
        process.env.NODE_ENV || 'development'
      ),
    }),
  ],
});
