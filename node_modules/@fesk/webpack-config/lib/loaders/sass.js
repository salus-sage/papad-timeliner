const fs = require('fs');
const path = require('path');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const { getFeskConfig } = require('../utils/get-fesk-config');

const config = getFeskConfig();
const useHash = config.chunkHash ? config.chunkHash : false;

module.exports = {
  test: /\.s?[ac]ss$/,
  use: [
    {
      loader: MiniCssExtractPlugin.loader,
      options: {
        filename: useHash ? '[name].[hash].css' : '[name].css',
        chunkFilename: useHash ? '[id].[hash].css' : '[id].css',
      },
    },
    require.resolve('css-loader'),
    {
      loader: require.resolve('postcss-loader'),
      options: {
        ident: 'postcss',
        plugins: loader => [require('autoprefixer')(), require('cssnano')()],
      },
    },
    require.resolve('sass-loader'),
  ],
};
