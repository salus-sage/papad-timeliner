const Config = require('webpack-config').default;
const { getFeskConfig } = require('../utils/get-fesk-config');

const config = getFeskConfig();

const cacheGroups = {
  styles: {
    name: 'main',
    test: /\.css$/,
    chunks: 'all',
    enforce: true,
  },
};

if (config.splitVendors) {
  cacheGroups.vendor = {
    test: /[\\/]node_modules[\\/]/,
    name: 'vendors',
    chunks: 'all',
  };
}

module.exports = new Config().merge({
  optimization: {
    minimizer: [
      require('../plugins/terser'),
      require('../plugins/optimize-css'),
    ],
    splitChunks: {
      cacheGroups,
    },
  },
});
