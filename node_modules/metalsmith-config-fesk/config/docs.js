const rootOrSubdirectory = require('../lib/rootOrSubdirectory');
const watch = require('../lib/watch');
const documentation = require('@fesk/plugin-documentation');

function docs(metalsmith, configuration) {
  const config = Object.assign(
    {
      isRoot: false,
      documentationPath: 'docs',
      assetFilePath: '../assets',
      assetFileDestination: 'dist',
      // Not supported by markdown plugin yet.
      // defaultLayout: 'layouts/default.twig',
    },
    configuration
  );

  return documentation(
    metalsmith
      .source(`./src/${config.documentationPath}`)
      .destination(
        config.isRoot ? './dist' : `./dist/${config.documentationPath}`
      )
      .use(rootOrSubdirectory(config.isRoot, config.documentationPath))
      .use(watch(config)),
    config
  );
}

module.exports = {
  name: 'docs',
  metalsmith: docs,
  path: 'docs',
  bundledAssets: require.resolve('../bundles/docs'),
};
