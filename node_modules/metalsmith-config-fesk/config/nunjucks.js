const nunjucksPlugin = require('@fesk/plugin-nunjucks');
const rootOrSubdirectory = require('../lib/rootOrSubdirectory');
const watch = require('../lib/watch');

function nunjucks(metalsmith, configuration) {
  const config = Object.assign(
    {
      isRoot: false,
      templatePath: 'nunjucks',
      assetFilePath: '../assets',
      assetFileDestination: 'dist',
    },
    configuration
  );

  return nunjucksPlugin(
    metalsmith
      .source(`./src/${config.templatePath}`)
      .destination(config.isRoot ? './dist' : `./dist/${config.templatePath}`)
      .use(rootOrSubdirectory(config.isRoot, config.templatePath))
      .use(watch(config)),
    config
  );
}

module.exports = {
  name: 'nunjucks',
  metalsmith: nunjucks,
  path: 'nunjucks',
};
