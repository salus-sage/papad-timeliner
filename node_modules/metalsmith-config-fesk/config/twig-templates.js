const twigTemplatesPlugin = require('@fesk/plugin-twig-templates');
const rootOrSubdirectory = require('../lib/rootOrSubdirectory');
const watch = require('../lib/watch');

function twigTemplates(metalsmith, configuration) {
  const config = Object.assign(
    {
      isRoot: false,
      twigTemplatePath: 'twig-templates',
      assetFilePath: '../assets',
      assetFileDestination: 'dist',
      defaultLayout: 'layouts/default.twig',
      layouts: 'layouts',
    },
    configuration
  );

  return twigTemplatesPlugin(
    metalsmith
      .source(`./src/${config.twigTemplatePath}`)
      .destination(
        config.isRoot ? './dist' : `./dist/${config.twigTemplatePath}`
      )
      .use(rootOrSubdirectory(config.isRoot, config.twigTemplatePath))
      .use(watch(config)),
    config
  );
}

module.exports = {
  name: 'twig-templates',
  metalsmith: twigTemplates,
  path: 'twig-templates',
};
